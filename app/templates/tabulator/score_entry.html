{% extends "base.html" %}

{% block content %}
<section class="content-section">
  <div class="container">
    <h2>{{ competition.name }} Scoring</h2>
    <p>Enter scores per judge and contestant. Locking is irreversible.</p>

    {% if not judges or not contestants or not criteria %}
      <div class="alert alert-warning">Please ensure judges, contestants, and criteria are configured for this competition.</div>
    {% else %}
      <form method="post" class="card-panel">
        {{ form.hidden_tag() }}
        <div class="row">
          <div class="col-md-6 mb-3">
            {{ form.judge_id.label(class="form-label") }}
            {{ form.judge_id(class="form-select") }}
          </div>
          <div class="col-md-6 mb-3">
            {{ form.contestant_id.label(class="form-label") }}
            {{ form.contestant_id(class="form-select") }}
          </div>
        </div>
        <div class="criteria-grid">
          {% for item in criteria %}
          <div>
            <label class="form-label">{{ item.name }} (max {{ item.max_score }})</label>
            {{ getattr(form, 'criteria_' ~ item.id)(class="form-control") }}
            {% if existing_scores.get(item.id) and existing_scores.get(item.id).locked %}
              <small class="text-warning">Locked</small>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        <div class="mt-3 d-flex gap-2">
          {{ form.submit_save(class="btn btn-accent") }}
          {{ form.submit_lock(class="btn btn-outline-danger") }}
        </div>
      </form>
    {% endif %}
  </div>
</section>
{% endblock %}
